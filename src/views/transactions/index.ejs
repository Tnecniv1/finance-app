<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progression - Fidess</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('../partials/navbar-simple', { currentPage: 'progression', user: user }) %>
    
    <%- include('../partials/progression-header', { currentView: currentView, stats: stats }) %>

    <div class="main-content">
        <!-- Messages d'erreur/succ√®s -->
        <% if (error) { %>
        <div class="alert alert-error">
            <%= error %>
        </div>
        <% } %>
        
        <% if (success) { %>
        <div class="alert alert-success">
            <%= success %>
        </div>
        <% } %>

        <!-- Suggestions IA (si pr√©sentes) -->
        <% if (suggestions && suggestions.length > 0) { %>
        <div class="card ai-suggestions-card">
            <div class="ai-suggestions-header">
                <h2>üí° Suggestions de cat√©gorisation</h2>
                <span class="ai-suggestions-count">
                    <%= suggestions.length %> suggestion(s)
                </span>
            </div>
            
            <div class="ai-suggestions-list">
                <% suggestions.forEach(suggestion => { %>
                    <div class="ai-suggestion-item">
                        <div class="suggestion-content">
                            <div class="suggestion-transaction">
                                <span class="suggestion-description">
                                    <%= suggestion.transaction.objet %>
                                </span>
                                <span class="suggestion-date">
                                    <%= new Date(suggestion.transaction.date).toLocaleDateString('fr-FR') %>
                                </span>
                            </div>
                            
                            <div class="suggestion-details">
                                <span class="suggestion-amount <%= suggestion.suggested_nature %>">
                                    <%= suggestion.suggested_nature === 'revenu' ? '+' : '-' %> 
                                    <%= parseFloat(suggestion.transaction.montant).toFixed(2) %> ‚Ç¨
                                </span>
                                
                                <div class="suggestion-arrow">‚Üí</div>
                                
                                <div class="suggestion-category-info">
                                    <% if (suggestion.suggested_nature === 'revenu' && suggestion.suggested_sous_categorie_revenu) { %>
                                        <span class="category-badge revenu">
                                            <%= suggestion.suggested_sous_categorie_revenu.nom %>
                                        </span>
                                    <% } else if (suggestion.suggested_nature === 'depense' && suggestion.suggested_sous_categorie_depense) { %>
                                        <span class="category-badge depense">
                                            <%= suggestion.suggested_sous_categorie_depense.nom %>
                                        </span>
                                    <% } %>
                                    
                                    <span class="confidence-score confidence-<%= Math.round(suggestion.confidence_score * 100) %>">
                                        <%= Math.round(suggestion.confidence_score * 100) %>%
                                    </span>
                                </div>
                            </div>

                            <% if (suggestion.matched_keyword) { %>
                                <div class="suggestion-keyword">
                                    üí° Bas√© sur: "<%= suggestion.matched_keyword %>"
                                </div>
                            <% } %>
                        </div>

                        <div class="suggestion-actions">
                            <form action="/transactions/ai/suggestions/<%= suggestion.id %>/accept" method="POST">
                                <button type="submit" class="btn-icon btn-accept" title="Accepter">
                                    ‚úÖ
                                </button>
                            </form>
                            <form action="/transactions/ai/suggestions/<%= suggestion.id %>/reject" method="POST">
                                <button type="submit" class="btn-icon btn-reject" title="Rejeter">
                                    ‚ùå
                                </button>
                            </form>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
        <% } %>

        <!-- Filtres -->
        <div class="card">
            <h2>üîç Filtrer les transactions</h2>
            <form action="/transactions" method="GET" class="filters-form">
                <!-- Ligne 1 : Recherche + Type + Cat√©gorie + Sous-cat√©gorie -->
                <div class="filters-row-main">
                    <!-- Recherche -->
                    <div class="filter-group">
                        <label for="recherche">Recherche</label>
                        <input 
                            type="text" 
                            id="recherche" 
                            name="recherche" 
                            placeholder="Rechercher..."
                            value="<%= filters.recherche %>"
                        >
                    </div>

                    <!-- Type -->
                    <div class="filter-group">
                        <label for="type">Type</label>
                        <select id="type" name="type" onchange="updateCategoryFilter()">
                            <option value="" <%= filters.type === '' ? 'selected' : '' %>>Tous</option>
                            <option value="revenu" <%= filters.type === 'revenu' ? 'selected' : '' %>>Revenus</option>
                            <option value="depense" <%= filters.type === 'depense' ? 'selected' : '' %>>D√©penses</option>
                        </select>
                    </div>

                    <!-- Cat√©gorie -->
                    <div class="filter-group">
                        <label for="categorie">Cat√©gorie</label>
                        <select id="categorie" name="categorie" onchange="updateSubcategoryFilter()">
                            <option value="">Toutes</option>
                            <optgroup label="üí∞ REVENUS" id="revenus-categories">
                                <% categories.revenus.forEach(cat => { %>
                                    <option value="<%= cat.id %>" <%= filters.categorie == cat.id ? 'selected' : '' %>>
                                        <%= cat.nom %>
                                    </option>
                                <% }); %>
                            </optgroup>
                            <optgroup label="üí∏ D√âPENSES" id="depenses-categories">
                                <% categories.depenses.forEach(cat => { %>
                                    <option value="<%= cat.id %>" <%= filters.categorie == cat.id ? 'selected' : '' %>>
                                        <%= cat.nom %>
                                    </option>
                                <% }); %>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Sous-cat√©gorie -->
                    <div class="filter-group">
                        <label for="sous_categorie">Sous-cat√©gorie</label>
                        <select id="sous_categorie" name="sous_categorie">
                            <option value="">Toutes</option>
                            <optgroup label="üí∞ REVENUS" id="revenus-subcategories">
                                <% categories.revenus.forEach(cat => { %>
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-parent="<%= cat.id %>" data-nature="revenu" <%= filters.sous_categorie == sc.id ? 'selected' : '' %>>
                                            <%= cat.nom %> ‚Ä∫ <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                <% }); %>
                            </optgroup>
                            <optgroup label="üí∏ D√âPENSES" id="depenses-subcategories">
                                <% categories.depenses.forEach(cat => { %>
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-parent="<%= cat.id %>" data-nature="depense" <%= filters.sous_categorie == sc.id ? 'selected' : '' %>>
                                            <%= cat.nom %> ‚Ä∫ <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                <% }); %>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <!-- Ligne 2 : Dates + Statut + IA + Boutons -->
                <div class="filters-row-dates">
                    <!-- Date d√©but -->
                    <div class="filter-group filter-date">
                        <label for="date_debut">Du</label>
                        <input 
                            type="date" 
                            id="date_debut" 
                            name="date_debut"
                            value="<%= filters.date_debut %>"
                        >
                    </div>

                    <!-- Date fin -->
                    <div class="filter-group filter-date">
                        <label for="date_fin">Au</label>
                        <input 
                            type="date" 
                            id="date_fin" 
                            name="date_fin"
                            value="<%= filters.date_fin %>"
                        >
                    </div>

                    <!-- Statut cat√©gorisation -->
                    <div class="filter-group filter-status">
                        <label>Statut</label>
                        <div class="status-buttons">
                            <button type="button" class="status-btn <%= !filters.categorized ? 'active' : '' %>" onclick="setCategorizationFilter('')">
                                Tous
                            </button>
                            <button type="button" class="status-btn <%= filters.categorized === 'yes' ? 'active' : '' %>" onclick="setCategorizationFilter('yes')">
                                Cat√©goris√©
                            </button>
                            <button type="button" class="status-btn <%= filters.categorized === 'no' ? 'active' : '' %>" onclick="setCategorizationFilter('no')">
                                Non cat√©goris√©
                            </button>
                        </div>
                        <input type="hidden" id="categorized" name="categorized" value="<%= filters.categorized || '' %>">
                    </div>

                    <!-- Bouton R√©currences -->
                    <div class="filter-group filter-recurrence">
                        <label>&nbsp;</label>
                        <a href="/recurrences/validate" class="btn-recurrence-compact" title="G√©rer les r√©currences">
                            üîÅ
                        </a>
                    </div>

                    <!-- Bouton IA -->
                    <div class="filter-group filter-ia">
                        <label>&nbsp;</label>
                        <button type="button" class="btn-ia-compact" onclick="generateAISuggestions()" title="G√©n√©rer des suggestions IA">
                            ü§ñ
                        </button>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="filter-actions">
                        <button type="submit" class="btn-filter">
                            üîç 
                        </button>
                        <a href="/transactions" class="btn-reset">
                            ‚úñÔ∏è 
                        </a>
                    </div>
                </div>
            </form>

            <!-- Stats IA compactes -->
            <% if (aiStats && aiStats.patterns.total > 0) { %>
            <div class="ai-stats-compact">
                <span class="ai-stat-item">
                    <strong><%= aiStats.patterns.total %></strong> patterns appris
                </span>
                <span class="ai-stat-divider">‚Ä¢</span>
                <span class="ai-stat-item">
                    <strong><%= aiStats.suggestions.pending %></strong> suggestions
                </span>
                <span class="ai-stat-divider">‚Ä¢</span>
                <span class="ai-stat-item">
                    <strong><%= aiStats.suggestions.acceptanceRate %>%</strong> pr√©cision
                </span>
                <a href="/transactions/ai/stats" class="ai-stats-link">üìä D√©tails</a>
            </div>
            <% } %>
        </div>

        <!-- Transactions -->
        <% if (transactions.length > 0) { %>
        <div class="card">
            <div class="bulk-actions-header">
                <h2>üìã Transactions (<%= transactions.length %>)</h2>
                <div class="bulk-actions">
                    <a href="/transactions/import-csv" class="btn btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    üì• Importer CSV
                    </a>
                    <button type="button" class="btn btn-secondary" onclick="selectAll()">
                        ‚òëÔ∏è Tout s√©lectionner
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="deselectAll()">
                        ‚¨ú Tout d√©s√©lectionner
                    </button>
                    <button type="button" class="btn btn-primary" onclick="openBulkCategorizeModal()">
                        üè∑Ô∏è Cat√©goriser la s√©lection
                    </button>
                </div>
            </div>

            <!-- Liste des transactions -->
            <div class="transactions-list">
                <% transactions.forEach(transaction => { %>
                    <div class="transaction-item <%= transaction.nature %>">
                        <!-- Checkbox de s√©lection -->
                        <input 
                            type="checkbox" 
                            class="transaction-checkbox" 
                            data-id="<%= transaction.id %>"
                            data-nature="<%= transaction.nature %>"
                        >

                        <div class="transaction-info">
                            <div class="transaction-header">
                                <span class="transaction-description">
                                    <%= transaction.objet %>
                                </span>
                                <span class="transaction-amount <%= transaction.nature %>">
                                    <%= transaction.nature === 'revenu' ? '+' : '-' %> 
                                    <%= parseFloat(transaction.montant).toFixed(2) %> ‚Ç¨
                                </span>
                            </div>
                            <div class="transaction-meta">
                                <span class="transaction-date">
                                    <%= new Date(transaction.date).toLocaleDateString('fr-FR', { 
                                        weekday: 'short', 
                                        year: 'numeric', 
                                        month: 'short', 
                                        day: 'numeric' 
                                    }) %>
                                </span>
                                <% if (transaction.nature === 'revenu' && transaction.sous_categorie_revenu) { %>
                                    <span class="transaction-category revenu">
                                        <%= transaction.sous_categorie_revenu.nom %>
                                    </span>
                                <% } else if (transaction.nature === 'depense' && transaction.sous_categorie_depense) { %>
                                    <span class="transaction-category depense">
                                        <%= transaction.sous_categorie_depense.nom %>
                                    </span>
                                <% } else { %>
                                    <span class="transaction-category uncategorized">
                                        Non cat√©goris√©e
                                    </span>
                                <% } %>
                            </div>
                        </div>

                        <div class="transaction-actions">
                            <button 
                                type="button" 
                                class="btn-action btn-categorize" 
                                onclick="openCategorizeModal('<%= transaction.id %>', '<%= transaction.nature %>')"
                                title="Cat√©goriser"
                            >
                                üè∑Ô∏è
                            </button>
                            <form action="/transactions/<%= transaction.id %>/delete" method="POST" 
                                  style="display: inline;"
                                  onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette transaction ?');">
                                <button type="submit" class="btn-action btn-delete" title="Supprimer">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
        <% } else { %>
            <div class="card">
                <p class="empty-state">Aucune transaction trouv√©e avec ces filtres.</p>
            </div>
        <% } %>
    </div>

    <!-- Modal de cat√©gorisation individuelle -->
    <div id="categorizeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCategorizeModal()">&times;</span>
            <h2>üè∑Ô∏è Cat√©goriser la transaction</h2>
            <form id="categorizeForm" action="" method="POST">
                <input type="hidden" name="nature" id="categorizeNature">
                
                <div class="form-group">
                    <label for="categorizeSubcategory">Sous-cat√©gorie *</label>
                    <select id="categorizeSubcategory" name="sous_categorie_id" required>
                        <option value="">S√©lectionnez une cat√©gorie</option>
                        <optgroup label="REVENUS" id="modal-revenus">
                            <% categories.revenus.forEach(cat => { %>
                                <optgroup label="  <%= cat.nom %>">
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-nature="revenu">
                                            <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                </optgroup>
                            <% }); %>
                        </optgroup>
                        <optgroup label="D√âPENSES" id="modal-depenses">
                            <% categories.depenses.forEach(cat => { %>
                                <optgroup label="  <%= cat.nom %>">
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-nature="depense">
                                            <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                </optgroup>
                            <% }); %>
                        </optgroup>
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Cat√©goriser
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeCategorizeModal()">
                        Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de cat√©gorisation en masse -->
    <div id="bulkCategorizeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeBulkCategorizeModal()">&times;</span>
            <h2>üè∑Ô∏è Cat√©goriser les transactions s√©lectionn√©es</h2>
            <p id="bulkSelectionCount" style="color: #666; margin-bottom: 20px;"></p>
            <form id="bulkCategorizeFormContent" action="/transactions/categorize-bulk" method="POST">
                <input type="hidden" name="nature" id="bulkCategorizeNature">
                
                <div class="form-group">
                    <label for="bulkCategorizeSubcategory">Sous-cat√©gorie *</label>
                    <select id="bulkCategorizeSubcategory" name="sous_categorie_id" required>
                        <option value="">S√©lectionnez une cat√©gorie</option>
                        <optgroup label="REVENUS" id="bulk-modal-revenus">
                            <% categories.revenus.forEach(cat => { %>
                                <optgroup label="  <%= cat.nom %>">
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-nature="revenu">
                                            <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                </optgroup>
                            <% }); %>
                        </optgroup>
                        <optgroup label="D√âPENSES" id="bulk-modal-depenses">
                            <% categories.depenses.forEach(cat => { %>
                                <optgroup label="  <%= cat.nom %>">
                                    <% cat.sous_categories.forEach(sc => { %>
                                        <option value="<%= sc.id %>" data-nature="depense">
                                            <%= sc.nom %>
                                        </option>
                                    <% }); %>
                                </optgroup>
                            <% }); %>
                        </optgroup>
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Cat√©goriser
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeBulkCategorizeModal()">
                        Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========================================
        // GESTION DES FILTRES
        // ========================================
        
        function updateCategoryFilter() {
            const type = document.getElementById('type').value;
            const revenusGroup = document.getElementById('revenus-categories');
            const depensesGroup = document.getElementById('depenses-categories');
            
            if (type === 'revenu') {
                revenusGroup.style.display = '';
                depensesGroup.style.display = 'none';
            } else if (type === 'depense') {
                revenusGroup.style.display = 'none';
                depensesGroup.style.display = '';
            } else {
                revenusGroup.style.display = '';
                depensesGroup.style.display = '';
            }
        }

        function updateSubcategoryFilter() {
            const categorieId = document.getElementById('categorie').value;
            const subOptions = document.querySelectorAll('#sous_categorie option[data-parent]');
            
            subOptions.forEach(opt => {
                if (!categorieId || opt.dataset.parent === categorieId) {
                    opt.style.display = '';
                } else {
                    opt.style.display = 'none';
                }
            });
        }

        function setCategorizationFilter(value) {
            document.getElementById('categorized').value = value;
            
            // Update button states
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // ========================================
        // S√âLECTION DES TRANSACTIONS
        // ========================================
        
        function selectAll() {
            document.querySelectorAll('.transaction-checkbox').forEach(cb => cb.checked = true);
        }

        function deselectAll() {
            document.querySelectorAll('.transaction-checkbox').forEach(cb => cb.checked = false);
        }

        function getSelectedTransactions() {
            const checkboxes = document.querySelectorAll('.transaction-checkbox:checked');
            return Array.from(checkboxes).map(cb => ({
                id: cb.dataset.id,
                nature: cb.dataset.nature
            }));
        }

        // ========================================
        // MODAL DE CAT√âGORISATION INDIVIDUELLE
        // ========================================
        
        function openCategorizeModal(id, nature) {
            document.getElementById('categorizeForm').action = `/transactions/${id}/categorize`;
            document.getElementById('categorizeNature').value = nature;
            
            const revenusGroup = document.getElementById('modal-revenus');
            const depensesGroup = document.getElementById('modal-depenses');
            
            if (nature === 'revenu') {
                revenusGroup.style.display = '';
                depensesGroup.style.display = 'none';
            } else {
                revenusGroup.style.display = 'none';
                depensesGroup.style.display = '';
            }
            
            document.getElementById('categorizeModal').style.display = 'flex';
        }

        function closeCategorizeModal() {
            document.getElementById('categorizeModal').style.display = 'none';
        }

        // ========================================
        // MODAL DE CAT√âGORISATION EN MASSE
        // ========================================
        
        function openBulkCategorizeModal() {
            const selected = getSelectedTransactions();
            
            if (selected.length === 0) {
                alert('Veuillez s√©lectionner au moins une transaction');
                return;
            }

            const natures = [...new Set(selected.map(t => t.nature))];
            if (natures.length > 1) {
                alert('Veuillez s√©lectionner uniquement des revenus OU des d√©penses, pas les deux');
                return;
            }

            const nature = natures[0];
            document.getElementById('bulkCategorizeNature').value = nature;
            document.getElementById('bulkSelectionCount').textContent = 
                `${selected.length} transaction(s) s√©lectionn√©e(s)`;

            const revenusGroup = document.getElementById('bulk-modal-revenus');
            const depensesGroup = document.getElementById('bulk-modal-depenses');
            
            if (nature === 'revenu') {
                revenusGroup.style.display = '';
                depensesGroup.style.display = 'none';
            } else {
                revenusGroup.style.display = 'none';
                depensesGroup.style.display = '';
            }

            const form = document.getElementById('bulkCategorizeFormContent');
            form.querySelectorAll('input[name="transaction_ids[]"]').forEach(i => i.remove());
            
            selected.forEach(t => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'transaction_ids[]';
                input.value = t.id;
                form.appendChild(input);
            });

            document.getElementById('bulkCategorizeModal').style.display = 'flex';
        }

        function closeBulkCategorizeModal() {
            document.getElementById('bulkCategorizeModal').style.display = 'none';
        }

        // ========================================
        // G√âN√âRATION SUGGESTIONS IA
        // ========================================
        
        function generateAISuggestions() {
            if (confirm('Voulez-vous g√©n√©rer des suggestions de cat√©gorisation par IA ?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/transactions/ai/generate-suggestions';
                document.body.appendChild(form);
                form.submit();
            }
        }

        // ========================================
        // FERMER LES MODALS
        // ========================================
        
        window.onclick = function(event) {
            const categorizeModal = document.getElementById('categorizeModal');
            const bulkModal = document.getElementById('bulkCategorizeModal');
            
            if (event.target === categorizeModal) {
                closeCategorizeModal();
            }
            if (event.target === bulkModal) {
                closeBulkCategorizeModal();
            }
        }

        // Initialiser les filtres au chargement
        document.addEventListener('DOMContentLoaded', function() {
            updateCategoryFilter();
            updateSubcategoryFilter();
        });
    </script>

    <style>
        /* ==========================================
           STRUCTURE G√âN√âRALE
        ========================================== */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* ==========================================
           ALERTS
        ========================================== */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: 500;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #dc2626;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        /* ==========================================
           SUGGESTIONS IA
        ========================================== */
        .ai-suggestions-card {
            background: #f8f9fa;
            border: 2px solid #667eea;
        }

        .ai-suggestions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .ai-suggestions-header h2 {
            margin: 0;
            color: #667eea;
        }

        .ai-suggestions-count {
            background: #667eea;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ai-suggestions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-suggestion-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            transition: all 0.2s;
        }

        .ai-suggestion-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateX(5px);
        }

        .suggestion-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .suggestion-transaction {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-description {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }

        .suggestion-date {
            color: #6b7280;
            font-size: 0.85rem;
        }

        .suggestion-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .suggestion-amount {
            font-weight: bold;
            font-size: 1.1rem;
            min-width: 100px;
        }

        .suggestion-amount.revenu {
            color: #10b981;
        }

        .suggestion-amount.depense {
            color: #ef4444;
        }

        .suggestion-arrow {
            color: #667eea;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .suggestion-category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .category-badge.revenu {
            background: #d1fae5;
            color: #065f46;
        }

        .category-badge.depense {
            background: #fee2e2;
            color: #991b1b;
        }

        .confidence-score {
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .confidence-score.confidence-90,
        .confidence-score.confidence-95,
        .confidence-score.confidence-100 {
            background: #d1fae5;
            color: #065f46;
        }

        .confidence-score.confidence-75,
        .confidence-score.confidence-80,
        .confidence-score.confidence-85 {
            background: #fef3c7;
            color: #92400e;
        }

        .confidence-score.confidence-60,
        .confidence-score.confidence-65,
        .confidence-score.confidence-70,
        .confidence-score.confidence-50,
        .confidence-score.confidence-55 {
            background: #fee2e2;
            color: #991b1b;
        }

        .suggestion-keyword {
            color: #667eea;
            font-size: 0.85rem;
            font-style: italic;
        }

        .suggestion-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.3rem;
            transition: all 0.2s;
        }

        .btn-accept {
            background: #d1fae5;
        }

        .btn-accept:hover {
            background: #10b981;
            transform: scale(1.1);
        }

        .btn-reject {
            background: #fee2e2;
        }

        .btn-reject:hover {
            background: #ef4444;
            transform: scale(1.1);
        }

        /* ==========================================
           FILTRES
        ========================================== */
        .filters-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .filters-row-main {
            display: grid;
            grid-template-columns: 2fr 1.2fr 1.5fr 1.5fr;
            gap: 12px;
            align-items: end;
        }

        .filters-row-dates {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 60px auto;
            gap: 12px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #333;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-date {
            max-width: 180px;
        }

        .filter-status {
            min-width: 200px;
        }

        .status-buttons {
            display: flex;
            gap: 5px;
        }

        .status-btn {
            flex: 1;
            padding: 10px 8px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .status-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .status-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .filter-ia {
            max-width: 60px;
        }

        .btn-ia-compact {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-ia-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .filter-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .btn-filter,
        .btn-reset {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .btn-filter {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-width: 110px;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-reset {
            background: #f3f4f6;
            color: #374151;
            min-width: 130px;
        }

        .btn-reset:hover {
            background: #e5e7eb;
            transform: translateY(-2px);
        }

        /* Stats IA compactes */
        .ai-stats-compact {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            margin-top: 15px;
            font-size: 13px;
            border-left: 4px solid #667eea;
        }

        .ai-stat-item {
            color: #666;
        }

        .ai-stat-item strong {
            color: #667eea;
            font-size: 16px;
            margin-right: 4px;
        }

        .ai-stat-divider {
            color: #d1d5db;
        }

        .ai-stats-link {
            margin-left: auto;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .ai-stats-link:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .filter-recurrence {
            max-width: 60px;
        }

        .btn-recurrence-compact {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-recurrence-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }


        /* ==========================================
           TRANSACTIONS
        ========================================== */
        .bulk-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .bulk-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .transaction-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .transaction-item:hover {
            border-color: #d1d5db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .transaction-item.revenu {
            border-left: 4px solid #10b981;
        }

        .transaction-item.depense {
            border-left: 4px solid #ef4444;
        }

        .transaction-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .transaction-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-description {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .transaction-amount.revenu {
            color: #10b981;
        }

        .transaction-amount.depense {
            color: #ef4444;
        }

        .transaction-meta {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .transaction-date {
            color: #999;
            font-size: 0.85rem;
        }

        .transaction-category {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .transaction-category.revenu {
            background: #d1fae5;
            color: #065f46;
        }

        .transaction-category.depense {
            background: #fee2e2;
            color: #991b1b;
        }

        .transaction-category.uncategorized {
            background: #fef3c7;
            color: #92400e;
        }

        .transaction-actions {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            padding: 8px 12px;
            border: none;
            background: #f3f4f6;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .btn-action:hover {
            transform: scale(1.1);
        }

        .btn-categorize:hover {
            background: #dbeafe;
        }

        .btn-delete:hover {
            background: #fee2e2;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px;
            font-size: 1.1rem;
        }

        /* ==========================================
           MODALS
        ========================================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-content h2 {
            margin: 0 0 20px 0;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #666;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #666;
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* ==========================================
           RESPONSIVE
        ========================================== */
        @media (max-width: 1200px) {
            .filters-row-main {
                grid-template-columns: 1fr 1fr;
            }
            
            .filters-row-dates {
                display: grid;
                grid-template-columns: 1fr 1fr 2fr 60px 60px auto;  /* Ajout d'une colonne pour r√©currences */
                gap: 12px;
                align-items: end;
            }

            .filter-date,
            .filter-status,
            .filter-ia {
                max-width: 100%;
            }

            .filter-actions {
                grid-column: 1 / -1;
                justify-content: stretch;
            }

            .btn-filter,
            .btn-reset {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 10px;
            }

            .card {
                padding: 15px;
            }

            .filters-row-main,
            .filters-row-dates {
                grid-template-columns: 1fr;
            }

            .bulk-actions-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .bulk-actions {
                width: 100%;
                flex-direction: column;
            }

            .btn-secondary,
            .btn-primary {
                width: 100%;
            }

            .transaction-item {
                flex-wrap: wrap;
            }

            .ai-stats-compact {
                flex-direction: column;
                align-items: flex-start;
            }

            .ai-stats-link {
                margin-left: 0;
                margin-top: 10px;
            }

            .ai-suggestion-item {
                flex-direction: column;
                align-items: stretch;
            }

            .suggestion-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</body>
</html>
